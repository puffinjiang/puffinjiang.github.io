[{"content":"ç°è±¡ å¼€å‘äº†ä¸€ä¸ªä¸‹è½½æ–‡ä»¶çš„æ¥å£ï¼Œä½¿ç”¨ Content-Disposition æŒ‡å®šé»˜è®¤ä¸‹è½½é™„ä»¶æ–‡ä»¶åï¼Œä½†æ˜¯æ¯æ¬¡ä¸‹è½½é»˜è®¤æ–‡ä»¶åä¸æŒ‡å®šçš„ä¸ä¸€è‡´\nåŸºç¡€ç¯å¢ƒ JDK 8 SpringBoot 2.2.5 æ¥å£ä»£ç  å‡ºäºæŸäº›åŸå› ï¼Œè¿™é‡Œåªå±•ç¤ºä¸‹è½½ç›¸å…³çš„ä»£ç ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 import io.swagger.annotations.ApiOperation; import org.slf4j.Logger; import org.slf4j.LoggerFactory; import org.springframework.core.io.FileSystemResource; import org.springframework.http.CacheControl; import org.springframework.http.MediaType; import org.springframework.http.ResponseEntity; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; import java.io.File; import java.net.URLEncoder; import java.util.concurrent.TimeUnit; @RestController @RequestMapping({\u0026#34;/api/v1\u0026#34;}) public class DownloadController { private Logger logger = LoggerFactory.getLogger(getClass()); @GetMapping(\u0026#34;/download/{id}\u0026#34;) @ApiOperation(\u0026#34;Download file by id\u0026#34;) public ResponseEntity\u0026lt;FileSystemResource\u0026gt; downloadFile(@PathVariable(\u0026#34;id\u0026#34;) Long id) throws Exception { String url = String.format(\u0026#34;data/%s.pdf\u0026#34;, id); File file = new File(url); if (!file.isFile()) { logger.error(\u0026#34;ERROR download file, can not find the file, ID: {}, url: {}\u0026#34;, id, url); return ResponseEntity.notFound().build(); } return ResponseEntity .ok() .header(\u0026#34;Content-Disposition\u0026#34;, \u0026#34;attachment; filename=\u0026#34; + URLEncoder.encode(file.getName(), \u0026#34;utf-8\u0026#34;)) .contentType(MediaType.APPLICATION_OCTET_STREAM) .contentLength(file.length()) .cacheControl(CacheControl.maxAge(60, TimeUnit.SECONDS)) .body(new FileSystemResource(file)); } } å…·ä½“ç°è±¡ åœ¨ç‚¹å‡»ä¸‹è½½çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœä¸‹è½½çš„æ–‡ä»¶IDä¸º 1 æ—¶ï¼Œé»˜è®¤ä¸‹è½½çš„æ–‡ä»¶ååˆ™ä¸º 1, è€ŒéResponse header ä¸­è®¾ç½®çš„filename 1.pdf\nåŸå› æ’æŸ¥ ç¡®å®šæ’æŸ¥èŒƒå›´ æ¥å£å·²ç»ç»è¿‡æµ‹è¯•ï¼Œé™¤é»˜è®¤è®¾ç½®çš„æ–‡ä»¶åä¸ç”Ÿæ•ˆå¤–ï¼Œæš‚æœªå‘ç°å…¶ä»–é—®é¢˜ã€‚è€Œé»˜è®¤è®¾ç½®çš„æ–‡ä»¶åç”± .header(\u0026quot;Content-Disposition\u0026quot;, \u0026quot;attachment; filename=\u0026quot; + URLEncoder.encode(file.getName(), \u0026quot;utf-8\u0026quot;)) è¿™ä¸€è¡Œæ§åˆ¶ï¼Œåˆ™å°†èŒƒå›´è®¾ç½®ä¸º Response header Content-Disposition ç›¸å…³çš„é—®é¢˜\næŸ¥è¯¢ç›¸å…³ä¿¡æ¯ åœ¨ç¡®å®šäº†æ’æŸ¥èŒƒå›´ä¹‹åï¼Œæ ¹æ®ç›¸å…³çš„å…³é”®è¯æŸ¥è¯¢ä¿¡æ¯ã€‚\næ ¹æ®å…³é”®è¯ http response attachment filename æœç´¢ç›¸å…³çš„ä¿¡æ¯ï¼Œåœ¨MDN Web Docsä¸Šæ‰¾åˆ°äº†å¯¹äºContent-Dispositionçš„æè¿° MDN Web Docsä¸­æè¿°çš„æ ¼å¼å¦‚ä¸‹ Content-Disposition: attachment; filename=\u0026quot;filename.jpg\u0026quot; å°†æ¥å£è¿”å›çš„ç»“æœ Content-Disposition: attachment; filename=filename.pdf ä¸æ–‡æ¡£æè¿°è¿›è¡Œå¯¹æ¯”ï¼Œå‘ç° filename= åé¢ç¼ºå¤±äº† \u0026quot; ç¬¦å·ã€‚ ä¿®æ”¹ç›¸å…³çš„ä»£ç ï¼Œæ·»åŠ  \u0026quot; ç¬¦å·ï¼Œå°†ç›¸å…³çš„ä»£ç ä¿®æ”¹å¦‚ä¸‹åè¿›è¡Œæµ‹è¯• 1 2 3 4 5 6 7 return ResponseEntity .ok() .header(\u0026#34;Content-Disposition\u0026#34;, \u0026#34;attachment; filename=\\\u0026#34;\u0026#34; + URLEncoder.encode(file.getName(), \u0026#34;utf-8\u0026#34;) + \u0026#34;\\\u0026#34;\u0026#34;) .contentType(MediaType.APPLICATION_OCTET_STREAM) .contentLength(file.length()) .cacheControl(CacheControl.maxAge(60, TimeUnit.SECONDS)) .body(new FileSystemResource(file)); è§£å†³æ–¹æ¡ˆ ä¿®æ”¹ä»£ç ï¼Œåœ¨ filename= åé¢æ·»åŠ  \u0026quot;\n","permalink":"https://puffinjiang.github.io/posts/tech/downloadattachmentfilenameinvalid/","summary":"è§£å†³æ–‡ä»¶ä¸‹è½½ä¸­é™„ä»¶è®¾ç½®filenameä¸ç”Ÿæ•ˆé—®é¢˜","title":"Download Attachment Filename Invalid"},{"content":"æŒ‚è½½æ­¥éª¤ å°†ç¡¬ç›˜æ’å…¥åˆ°ç”µè„‘ä¸Š\næŸ¥çœ‹æ–°ç£ç›˜æ˜¯å¦å­˜åœ¨ 1 fdisk -l æ ¹æ®æ˜¾ç¤ºç»“æœæŸ¥æ‰¾å¯¹åº”çš„ç¡¬ç›˜ï¼Œè¿™é‡Œæ˜¯ /dev/sde1ï¼š\n1 2 3 4 5 6 7 8 9 10 Disk /dev/sde: 1.9 TiB, 2048408248320 bytes, 4000797360 sectors Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disklabel type: dos Disk identifier: 0x636b9949 Device Boot Start End Sectors Size Id Type /dev/sde1 2048 4000794623 4000792576 1.9T 7 HPFS/NTFS/exFAT æŒ‚è½½ç¡¬ç›˜ è¿™é‡Œæˆ‘å°†ç¡¬ç›˜æŒ‚è½½åˆ° /prod/backup è·¯å¾„ä¸‹ï¼Œå¹¶æˆæƒè¯»å†™(-rw)\n1 mount -o rw /dev/sde1 /prod/backup æŸ¥çœ‹ç£ç›˜æƒ…å†µ 1 df -lh ä½¿ç”¨ df -lh å‘½ä»¤æŸ¥çœ‹ç£ç›˜æ˜¯å¦æˆåŠŸæŒ‚è½½ï¼Œå¦‚ä¸‹æœ‰æ˜¾ç¤º /dev/sde åˆ™è¡¨ç¤ºæ­£å¸¸\n1 2 tmpfs 9.5G 0 9.5G 0% /run/user/0 /dev/sde1 1.9T 951G 957G 50% /prod/backup å¸è½½æŒ‚è½½ç‚¹ 1 umount /dev/sde1 ","permalink":"https://puffinjiang.github.io/posts/tech/mountingaharddriveinubuntu/","summary":"åœ¨Ubuntuä¸‹æŒ‚è½½æ–°ç¡¬ç›˜","title":"Mounting A Hard Drive In Ubuntu"},{"content":"èƒŒæ™¯\u0026amp;ç°è±¡ ç¯å¢ƒ æ“ä½œç³»ç»Ÿï¼šMacOS å·¥å…·ï¼šIdeaã€Maven\nç°è±¡ Javaä¸‹çš„å¸¸è§„çˆ¶å­å·¥ç¨‹é¡¹ç›®ï¼Œproject1ä¾èµ– project2ã€‚\nå¯¹project2å•ç‹¬ä½¿ç”¨mvn installæ—¶ï¼ŒæˆåŠŸ install å¯¹project1å•ç‹¬ä½¿ç”¨mvn packageæ—¶ æŠ¥é”™å¦‚ä¸‹ï¼š 1 Failed to execute goal on project/Could not resolve dependencies for project åŸå›  è§£å†³åŠæ³• æ­¥éª¤å¦‚ä¸‹ï¼š\nä½¿ç”¨çˆ¶å·¥ç¨‹çš„pomæ–‡ä»¶ï¼Œä½¿ç”¨mvn cleanæ¸…ç©ºç›¸å…³æ–‡ä»¶ ä½¿ç”¨mvn installå‘½ä»¤ï¼Œå°†ç›¸å…³çš„jarå®‰è£…åˆ°æœ¬åœ°çš„mavenä»“åº“ å¯¹å…·ä½“çš„project1 ä½¿ç”¨mvn packageå‘½ä»¤æ‰“åŒ… ","permalink":"https://puffinjiang.github.io/posts/tool/mavenfailtoexecutegoalonproject/","summary":"åœ¨çˆ¶å­å·¥ç¨‹é¡¹ç›®ä¸­ã€æœ‰ä¾èµ–å…³ç³»çš„å­é¡¹ç›®æ‰“åŒ…æ—¶æ‰¾ä¸åˆ°ä¾èµ–","title":"Mavençˆ¶å­å·¥ç¨‹ï¼Œå­é¡¹ç›®ç›¸äº’ä¾èµ–ï¼Œæ‰“åŒ…æ—¶æ‰¾ä¸åˆ°ä¾èµ–"},{"content":"å®‰è£…virtualbox â—æ³¨æ„ï¼Œä¸€å®šè¦è®¾ç½®æ‹“å±•åŒ…ç‰¹æ€§ï¼Œåç»­æ‰èƒ½ä½¿ç”¨windowsè¿œç¨‹æ¡Œé¢è¿æ¥ã€‚Ubuntué»˜è®¤æ˜¯VNCçš„è¿æ¥æ–¹å¼ï¼Œé€šè¿‡è®¾ç½®æ‹“å±•åŒ…ç‰¹æ€§ï¼Œä¿®æ”¹ä¸ºvrdpçš„è¿æ¥æ–¹å¼\nå®‰è£…virtualboxè½¯ä»¶ 1 apt-get install virtualbox å®‰è£…æ‹“å±•åŒ… 1 apt install virtualbox-ext-pack æ£€æŸ¥æ‹“å±•åŒ…æ˜¯å¦å®‰è£…æˆåŠŸï¼š\n1 VBoxManage list extpacks è®¾ç½®æ‹“å±•åŒ…ç‰¹æ€§ï¼Œä¸ºåç»­çš„è¿œç¨‹æ¡Œé¢è¿æ¥åšå‡†å¤‡\n1 VBoxManage setproperty vrdeextpack \u0026#34;Oracle VM VirtualBox Extension Pack\u0026#34; åˆ›å»ºè™šæ‹Ÿæœºï¼Œå¹¶å®‰è£…æ“ä½œç³»ç»Ÿ åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºï¼Œåç§°ä¸ºï¼šguest_os_1ï¼Œæ“ä½œç³»ç»Ÿä¸ºwindows10\nåˆ›å»ºè™šæ‹Ÿæœºä½¿ç”¨çš„è™šæ‹Ÿç¡¬ç›˜ï¼Œæ–‡ä»¶è·¯å¾„ä¸º /prod/vmos/guest_os_1/guest_os_1.vdiï¼Œå¤§å°ä¸º100Gï¼Œå³102400m\n1 VBoxManage createmedium --filename /prod/vmos/guest_os_1/guest_os_1.vdi --size 102400 åˆ›å»ºè™šæ‹Ÿæœºï¼Œåç§°ä¸ºï¼šguest_os_1ï¼Œæ“ä½œç³»ç»Ÿä¸ºï¼šWindows10_64\n1 VBoxManage createvm --name \u0026#34;guest_os_1\u0026#34; --ostype Windows10_64 --register å¦‚æœéœ€è¦å®‰è£…å…¶ä»–ç±»å‹çš„æ“ä½œç³»ç»Ÿï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š\n1 VBoxManage list ostypes åˆ›å»ºstatç£ç›˜æ§åˆ¶å™¨ï¼Œå¹¶å’Œæ­¥éª¤ä¸€ä¸­çš„è™šæ‹Ÿç¡¬ç›˜ç»‘å®š\n1 VBoxManage storagectl guest_os_1 --name \u0026#34;SATA Controller\u0026#34; --add sata --controller IntelAHCI ç»‘å®šæ­¥éª¤ä¸€ä¸­çš„è™šæ‹Ÿç¡¬ç›˜\n1 VBoxManage storageattach guest_os_1 --storagectl \u0026#34;SATA Controller\u0026#34; --port 0 --device 0 --type hdd --medium /prod/vmos/guest_os_1/guest_os_1.vdi åˆ›å»ºIDEæ§åˆ¶å™¨ï¼Œè®¾ç½®ä¸ºDVDï¼Œå¹¶å’Œä¸‹è½½å¥½çš„Windows10 ISOæ–‡ä»¶ç»‘å®š\n1 VBoxManage storagectl guest_os_1 --name \u0026#34;IDE Controller\u0026#34; --add ide ç»‘å®šwindows isoé•œåƒæ–‡ä»¶ï¼Œé•œåƒæ–‡ä»¶è·¯å¾„ä¸ºï¼š/prod/iso/zh-cn_windows_10_business_editions_version_22h2_updated_nov_2022_x64_dvd_e310fb02.iso\n1 VBoxManage storageattach guest_os_1 --storagectl \u0026#34;IDE Controller\u0026#34; --port 1 --device 0 --type dvddrive --medium \u0026#34;/prod/iso/zh-cn_windows_10_business_editions_version_22h2_updated_nov_2022_x64_dvd_e310fb02.iso\u0026#34; ç»™è™šæ‹Ÿæœºåˆ†é…cpuå’Œå†…å­˜ï¼Œä»¥åˆ†é…4ä¸ªcpuå’Œ4gå†…å­˜ä¸ºä¾‹ï¼š\n1 VBoxManage modifyvm guest_os_1 --cpus 4 --memory 4096 è®¾ç½®è™šæ‹Ÿæœºçš„å¯åŠ¨é¡ºåºï¼Œé¦–å…ˆæ˜¯ç¡¬ç›˜ï¼Œå…¶æ¬¡æ˜¯dvd\n1 VBoxManage modifyvm guest_os_1 --boot1 disk --boot2 dvd æ‰“å¼€å’Œå…³é—­VRDEè¿œç¨‹è¿æ¥åŠŸèƒ½ï¼Œé»˜è®¤ç«¯å£ä¸º3389\nå¼€å¯VRDEè¿œç¨‹è¿æ¥ï¼š\n1 VBoxManage modifyvm guest_os_1 --vrde on å…³é—­VRDEè¿œç¨‹è¿æ¥ï¼š\n1 VBoxManage modifyvm guest_os_1 --vrde off è®¾ç½®ä¸ºè‡ªå®šä¹‰ç«¯å£ï¼Œä»¥è®¾ç½®ä¸º2233ä¸ºä¾‹ï¼š\n1 VBoxManage modifyvm guest_os_1 --vrdeport 2233 # é»˜è®¤ç«¯å£ä¸º3389 å¼€å¯è™šæ‹Ÿæœº\n1 VBoxManage startvm guest_os_1 --type=headlessÂ æŸ¥çœ‹è™šæ‹Ÿæœº\n1 2 3 4 5 # æŸ¥çœ‹æ‰€æœ‰çš„è™šæ‹Ÿæœº VBoxManage list vms # æŸ¥çœ‹è¿è¡Œä¸­çš„è™šæ‹Ÿæœº VBoxManage list runningvms é€šè¿‡windowsè¿œç¨‹æ¡Œé¢è¿æ¥è™šæ‹Ÿæœºï¼Œå¹¶å¼€å§‹å®‰è£…windowsç³»ç»Ÿã€‚ä»¥å®¿ä¸»æœºUbuntuçš„ipæ˜¯ 192.168.0.66 ä¸ºä¾‹ï¼Œè¿œç¨‹æ¡Œé¢è¿æ¥çš„ipå’Œç«¯å£åº”è®¾ç½®ä¸º 192.168.0.66:2233 ï¼Œæ­¤å¤„çš„ç«¯å£ä¸æ­¥éª¤7 ä¸­è®¾ç½®çš„ vrdeport ä¿æŒä¸€è‡´ã€‚\næŒ‚è½½å’Œå®‰è£… VBoxGuestAdditions.iso é•œåƒ\næŒ‚è½½é•œåƒï¼š\n1 VBoxManage storageattach guest_os_1 --storagectl \u0026#34;IDE Controller\u0026#34; --port 1 --device 0 --type dvddrive --medium \u0026#34;/usr/share/virtualbox/VBoxGuestAdditions.iso\u0026#34; å¼€å¯è™šæ‹Ÿæœºï¼Œè¿›å…¥é©±åŠ¨å™¨æ–‡ä»¶ä¸‹ï¼Œç‚¹å‡»å¯¹åº”çš„å®‰è£…æ–‡ä»¶\nwindowså®‰è£…æ–‡ä»¶è·¯å¾„ï¼š\n1 D:\\VBoxWindowsAdditions.exe æŒ‚è½½å’Œåˆ é™¤å®¿ä¸»æœºçš„æ–‡ä»¶å¤¹åˆ°è™šæ‹Ÿæœº\nâ—æ³¨æ„ï¼Œæ­¤æŒ‚è½½å‘½ä»¤åœ¨6.1ç‰ˆæœ¬æ‰ç”Ÿæ•ˆ\næŒ‚è½½å®¿ä¸»æœºæ–‡ä»¶å¤¹ \u0026lsquo;/prod/data\u0026rsquo; ä¸ºè™šæ‹ŸæœºWindowsç³»ç»Ÿçš„ \u0026lsquo;Y:/\u0026rsquo;ï¼Œç›¸å…³å‚æ•°ä½œç”¨å¦‚ä¸‹ï¼š\n\u0026ndash;name æŒ‚è½½çš„æ–‡ä»¶å¤¹åç§° \u0026ndash;hostpath æŒ‡å®šå®¿ä¸»æœºæ–‡ä»¶å¤¹ \u0026ndash;readonly è®¾ç½®è™šæ‹Ÿæœºç³»ç»Ÿåªèƒ½è¯»æ•°æ®ï¼Œä¸å…è®¸å†™ 1 VBoxManage sharedfolder add guest_os_1 --name \u0026#39;data\u0026#39; --hostpath \u0026#39;/prod/data\u0026#39; --readonly --automount --auto-mount-point \u0026#39;Y:/\u0026#39; åˆ é™¤æŒ‚è½½\n1 VBoxManage sharedfolder remove guest_os_1 --name \u0026#39;data\u0026#39; åˆ é™¤è™šæ‹Ÿæœº å…³é—­è™šæ‹Ÿæœº\n1 VBoxManage controlvm guest_os_1 poweroff åˆ é™¤è™šæ‹Ÿæœºï¼Œå‘½ä»¤å¦‚ä¸‹ã€æ­¤å‘½ä»¤ä¼šåˆ é™¤å¯¹åº”è™šæ‹Ÿæœºçš„æ–‡ä»¶åŠé…ç½®ä¿¡æ¯ã€‚\n1 VBoxManage unregistervm --delete guest_os_1 ","permalink":"https://puffinjiang.github.io/posts/tool/installwindowsoswithvirtualboxheadlessunderubuntu/","summary":"Ubuntuä¸‹ä½¿ç”¨æ— Guiçš„Virtualboxè™šæ‹Ÿæœºå®‰è£…Windowsæ“ä½œç³»ç»Ÿ","title":"Ubuntu ä¸‹ä½¿ç”¨ Virtualbox Headless å®‰è£… Windows ç³»ç»Ÿ"},{"content":"è®°å½•ä¸€äº›å·¥ä½œè¿‡ç¨‹ä¸­ç»å¸¸ä¼šä½¿ç”¨çš„Mysqlå‘½ä»¤\nDDLï¼ˆDatabase Definition Languageï¼‰ Create Database\n1 CREATE DATABASE dbname; Show Database\n1 SHOW DATABASES; Use database\n1 USE dbname; Drop Database\n1 DROP DATABASE dbname; Create Table\n1 2 3 4 5 6 7 8 CREATE TABLE IF NOT EXISTS `demo`( `id` INT UNSIGNED AUTO_INCREMENT, `name` VARCHAR(100) NOT NULL, `password` VARCHAR(40) NOT NULL, `create_time` TIMESTAMP NOT NULL DEFAULT NOW(), `update_time` TIMESTAMP NOT NUll DEFAULT CURRENT_TIMESTAMP(), PRIMARY KEY ( `runoob_id` ) )ENGINE=InnoDB DEFAULT CHARSET=utf8; Change Table\nChange name of column password to passwd\n1 ALTER TABLE demo CHANGE password passwd; Drop Table\n1 DROP TABLE demo; DML add data into table demo\n1 INSERT INTO demo(name,password) VALUES(\u0026#39;name1\u0026#39;,\u0026#39;password1\u0026#39;); Change data\n1 UPDATE demo SET name=\u0026#39;name2\u0026#39; where id = 1; delete data\n1 DELETE FROM demo WHERE id = 1; select data\nselect data by time, accurate to the second\n1 SELECT * FROM demo WHERE timestamp(create_date) BETWEEN \u0026#39;2023-01-01 00:00:00\u0026#39; AND \u0026#39;2023-01-31 00:00:00\u0026#39;; select data by date, accurate to the day\n1 SELECT * FROM demo WHERE date(create_date) BETWEEN \u0026#39;2023-01-01\u0026#39; AND \u0026#39;2023-01-31\u0026#39;; use case when to conversion some select column\n1 SELECT CASE gender WHEN 0 THEN \u0026#39;ç”·\u0026#39; WHEN 1 THEN \u0026#39;å¥³\u0026#39; END AS \u0026#39;æ€§åˆ«\u0026#39;, CASE WHEN status IS NULL THEN \u0026#39;æœªæäº¤\u0026#39; END AS \u0026#39;æäº¤çŠ¶æ€\u0026#39; FROM demo; DCL Authorization to users\n1 2 GRANT all privileges on dbname.* to username@\u0026#39;%\u0026#39; identified by password; flush privileges; Others backup backup database with mysqldump\n1 mysqldump -u root -h host -p dbname \u0026gt; backup_file.sql; restore restore database with mysqldump\n1 mysqldump -u root -h host -m dbname \u0026lt; backup_file.sql; ","permalink":"https://puffinjiang.github.io/posts/tool/mysqlcommoncommands/","summary":"è®°å½•ä¸€äº›å¸¸ç”¨çš„Mysqlæ•°æ®åº“å‘½ä»¤","title":"Mysql Common Commands"},{"content":"è®°å½•ä¸€ä¸‹å¼€å¯UbuntuæœåŠ¡å™¨çš„sshè¿œç¨‹è¿æ¥è¿‡ç¨‹\nSSHæœåŠ¡å®‰è£… 1. æ£€æŸ¥æœåŠ¡æ˜¯å¦å¼€å¯ é€šè¿‡ä¸‹é¢å‘½ä»¤æ£€æŸ¥æœåŠ¡æ˜¯å¦å¼€å¯\n1 ps -e | grep sshd 2. å®‰è£…æœåŠ¡ 1 apt install openssh-server 3. å¯ç”¨æœåŠ¡ 1 systemctl enable ssh 4. å¯åŠ¨æœåŠ¡ 1 systemctl start sshd.service æœåŠ¡é…ç½® é…ç½®æ–‡ä»¶è·¯å¾„ æ³¨æ„ï¼š ä½¿ç”¨çš„æ˜¯sshdè€Œä¸æ˜¯sshï¼Œsshæ˜¯ssh-clientç›¸å…³çš„ï¼Œsshdæ˜¯ssh-serverç›¸å…³ä¿¡æ¯ï¼Œè¦æ³¨æ„åŒºåˆ†ï¼\n1 vim /etc/ssh/sshd_config é…ç½®æ–‡ä»¶å†…å®¹åŠä½œç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 # Package generated configuration file # See the sshd_config(5) manpage for details # What ports, IPs and protocols we listen for Port 22 # Use these options to restrict which interfaces/protocols sshd will bind to #ListenAddress :: #ListenAddress 0.0.0.0 Protocol 2 # HostKeys for protocol version 2 HostKey /etc/ssh/ssh_host_rsa_key HostKey /etc/ssh/ssh_host_dsa_key HostKey /etc/ssh/ssh_host_ecdsa_key HostKey /etc/ssh/ssh_host_ed25519_key #Privilege Separation is turned on for security UsePrivilegeSeparation yes # Lifetime and size of ephemeral version 1 server key KeyRegenerationInterval 3600 ServerKeyBits 1024 # Logging SyslogFacility AUTH LogLevel INFO # Authentication: LoginGraceTime 120 #PermitRootLogin prohibit-password PermitRootLogin yes # å…è®¸rootè´¦å·ä½¿ç”¨sshç™»å½• StrictModes yes RSAAuthentication yes PubkeyAuthentication yes #AuthorizedKeysFile %h/.ssh/authorized_keys # Don\u0026#39;t read the user\u0026#39;s ~/.rhosts and ~/.shosts files IgnoreRhosts yes # For this to work you will also need host keys in /etc/ssh_k nown_hosts RhostsRSAAuthentication no # similar for protocol version 2 HostbasedAuthentication no # Uncomment if you don\u0026#39;t trust ~/.ssh/known_hosts for RhostsRSAAuthentication #IgnoreUserKnownHosts yes # To enable empty passwords, change to yes (NOT RECOMMENDED) PermitEmptyPasswords no # Change to yes to enable challenge-response passwords (beware issues with # some PAM modules and threads) ChallengeResponseAuthentication no # Change to no to disable tunnelled clear text passwords #PasswordAuthentication yes # Kerberos options #KerberosAuthentication no #KerberosGetAFSToken no #KerberosOrLocalPasswd yes #KerberosTicketCleanup yes # GSSAPI options #GSSAPIAuthentication no #GSSAPICleanupCredentials yes X11Forwarding yes X11DisplayOffset 10 PrintMotd no PrintLastLog yes TCPKeepAlive yes #UseLogin no #MaxStartups 10:30:60 #Banner /etc/issue.net # Allow client to pass locale environment variables AcceptEnv LANG LC_* Subsystem sftp /usr/lib/openssh/sftp-server # Set this to \u0026#39;yes\u0026#39; to enable PAM authentication, account processing, # and session processing. If this is enabled, PAM authentication will # be allowed through the ChallengeResponseAuthentication and # PasswordAuthentication. Depending on your PAM configuration, # PAM authentication via ChallengeResponseAuthentication may bypass # the setting of \u0026#34;PermitRootLogin without-password\u0026#34;. # If you just want the PAM account and session checks to run without # PAM authentication, then enable this but set PasswordAuthentication # and ChallengeResponseAuthentication to \u0026#39;no\u0026#39;. UsePAM yes ","permalink":"https://puffinjiang.github.io/posts/tool/remoteloginofubuntuserversetting/","summary":"Ubuntu å¼€å¯sshè¿œç¨‹è¿æ¥æœåŠ¡","title":"Remote Login Of Ubuntu Server Setting"},{"content":"è®°å½•ä¸€ä¸‹ä½¿ç”¨docker-composeéƒ¨ç½²å¸¸ç”¨çš„æœåŠ¡\nNginx 1 2 3 4 5 6 7 8 9 10 11 12 13 version: \u0026#39;3.4\u0026#39; services: nginx: image: nginx:alpine #é•œåƒåœ°å€ container_name: nginx #å®¹å™¨å restart: always ports: - \u0026#34;443:443\u0026#34; - \u0026#34;80:80\u0026#34; volumes: - ./conf/cert/:/etc/nginx/cert/ # sslè¯ä¹¦è·¯å¾„ - ./conf/conf.d/:/etc/nginx/conf.d/ # confé…ç½®æ–‡ä»¶ - ./logs:/var/log/nginx # æ—¥å¿— Mysql 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 version: \u0026#39;3.4\u0026#39; services: db: image: mysql container_name: mysql8 restart: always environment: MYSQL_ROOT_PASSWORD: password command: --default-authentication-plugin=mysql_native_password --character-set-server=utf8mb4 --collation-server=utf8mb4_general_ci --explicit_defaults_for_timestamp=true --lower_case_table_names=1 # é‡è¦ï¼Œè®¾ç½®mysqlä¸åŒºåˆ†å¤§å°å†™ --max_allowed_packet=128M; ports: - \u0026#34;3306:3306\u0026#34; volumes: - ./data:/var/lib/mysql # æ•°æ®æ–‡ä»¶ - ./conf:/etc/mysql/conf.d # é…ç½®æ–‡ä»¶ gitlab 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 version: \u0026#39;3.6\u0026#39; services: gitlab: image: \u0026#34;yrzr/gitlab-ce-arm64v8:latest\u0026#34; # æ­¤å¤„ä½¿ç”¨çš„æ˜¯arm64ä½çš„é•œåƒï¼Œç³»ç»Ÿæ˜¯amdæ¶æ„çš„ç›´æ¥ä½¿ç”¨ gitlab/gitlab-ce å³å¯ container_name: \u0026#34;gitlab\u0026#34; hostname: \u0026#39;gitlab.example.cn\u0026#39; # åŸŸåé…ç½® restart: always environment: GITLAB_OMNIBUS_CONFIG: | external_url \u0026#39;http://gitlab.example.cn:8181\u0026#39; #è¦ä¸ä¸‹é¢portsä¸­çš„ç«¯å£å¯¹åº” gitlab_rails[\u0026#39;gitlab_shell_ssh_port\u0026#39;] = 2222 # gitlab_rails[\u0026#39;smtp_enable\u0026#39;] = true # gitlab_rails[\u0026#39;smtp_address\u0026#39;] = \u0026#34;smtp.aliyun.com\u0026#34; # gitlab_rails[\u0026#39;smtp_port\u0026#39;] = 465 # gitlab_rails[\u0026#39;smtp_user_name\u0026#39;] = \u0026#34;example@example.com\u0026#34; #ç”¨è‡ªå·±çš„aliyuné‚®ç®± # gitlab_rails[\u0026#39;smtp_password\u0026#39;] = \u0026#34;password\u0026#34; # gitlab_rails[\u0026#39;smtp_domain\u0026#39;] = \u0026#34;aliyun.com\u0026#34; # gitlab_rails[\u0026#39;smtp_authentication\u0026#39;] = \u0026#34;login\u0026#34; # gitlab_rails[\u0026#39;smtp_enable_starttls_auto\u0026#39;] = true # gitlab_rails[\u0026#39;smtp_tls\u0026#39;] = true # gitlab_rails[\u0026#39;gitlab_email_from\u0026#39;] = \u0026#39;admin@example.com\u0026#39; ports: - \u0026#39;8181:8181\u0026#39; - \u0026#39;443:443\u0026#39; - \u0026#39;2222:22\u0026#39; volumes: - \u0026#39;/prod/gitlab/config:/etc/gitlab\u0026#39; - \u0026#39;/prod/gitlab/logs:/var/log/gitlab\u0026#39; - \u0026#39;/prod/gitlab/data:/var/opt/gitlab\u0026#39; shm_size: \u0026#39;256m\u0026#39; nexusä¸ªäººä»“åº“ æ­¤å¤„éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºæ˜ å°„çš„dataï¼Œéœ€è¦æˆäºˆ777æƒé™ï¼Œä¿è¯æ­£å¸¸çš„æ–‡ä»¶å¤¹çš„åˆ›å»ºå’Œæ–‡ä»¶çš„å†™å…¥\n1 2 3 4 5 6 7 8 9 10 version: \u0026#39;3.4\u0026#39; services: nexus: container_name: nexus3 image: sonatype/nexus3 restart: always ports: - \u0026#39;8889:8081\u0026#39; volumes: - /prod/nexus/data:/nexus-data ","permalink":"https://puffinjiang.github.io/posts/tool/deployservicewithdockercompose/","summary":"ä½¿ç”¨docker-composeéƒ¨ç½²å¸¸ç”¨çš„æœåŠ¡","title":"Deploy Service With Docker Compose"},{"content":"é¢å¤–å¼€é”€ æ¯ä¸ªç´¢å¼•å æ®ä¸€å®šçš„å­˜å‚¨ç©ºé—´ï¼Œåœ¨è¿›è¡Œæ’å…¥ï¼Œæ›´æ–°å’Œåˆ é™¤æ“ä½œæ—¶ä¹Ÿéœ€è¦å¯¹ç´¢å¼•è¿›è¡Œæ“ä½œã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ å¾ˆå°‘å¯¹é›†åˆè¿›è¡Œè¯»å–æ“ä½œï¼Œå»ºè®®ä¸ä½¿ç”¨ç´¢å¼•ã€‚\nå†…å­˜(RAM)ä½¿ç”¨ ç”±äºç´¢å¼•æ˜¯å­˜å‚¨åœ¨å†…å­˜(RAM)ä¸­,ä½ åº”è¯¥ç¡®ä¿è¯¥ç´¢å¼•çš„å¤§å°ä¸è¶…è¿‡å†…å­˜çš„é™åˆ¶ã€‚\nå¦‚æœç´¢å¼•çš„å¤§å°å¤§äºå†…å­˜çš„é™åˆ¶ï¼ŒMongoDBä¼šåˆ é™¤ä¸€äº›ç´¢å¼•ï¼Œè¿™å°†å¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚\næŸ¥è¯¢é™åˆ¶ ç´¢å¼•ä¸èƒ½è¢«ä»¥ä¸‹çš„æŸ¥è¯¢ä½¿ç”¨ï¼š\næ­£åˆ™è¡¨è¾¾å¼åŠéæ“ä½œç¬¦ï¼Œå¦‚ $nin, $not, ç­‰ã€‚ ç®—æœ¯è¿ç®—ç¬¦ï¼Œå¦‚ $mod, ç­‰ã€‚ $where å­å¥ æ‰€ä»¥ï¼Œæ£€æµ‹ä½ çš„è¯­å¥æ˜¯å¦ä½¿ç”¨ç´¢å¼•æ˜¯ä¸€ä¸ªå¥½çš„ä¹ æƒ¯ï¼Œå¯ä»¥ç”¨explainæ¥æŸ¥çœ‹ã€‚\nç´¢å¼•é”®é™åˆ¶ ä»2.6ç‰ˆæœ¬å¼€å§‹ï¼Œå¦‚æœç°æœ‰çš„ç´¢å¼•å­—æ®µçš„å€¼è¶…è¿‡ç´¢å¼•é”®çš„é™åˆ¶ï¼ŒMongoDBä¸­ä¸ä¼šåˆ›å»ºç´¢å¼•ã€‚\næ’å…¥æ–‡æ¡£è¶…è¿‡ç´¢å¼•é”®é™åˆ¶ å¦‚æœæ–‡æ¡£çš„ç´¢å¼•å­—æ®µå€¼è¶…è¿‡äº†ç´¢å¼•é”®çš„é™åˆ¶ï¼ŒMongoDBä¸ä¼šå°†ä»»ä½•æ–‡æ¡£è½¬æ¢æˆç´¢å¼•çš„é›†åˆã€‚ä¸mongorestoreå’Œmongoimportå·¥å…·ç±»ä¼¼ã€‚\næœ€å¤§èŒƒå›´ é›†åˆä¸­ç´¢å¼•ä¸èƒ½è¶…è¿‡64ä¸ª ç´¢å¼•åçš„é•¿åº¦ä¸èƒ½è¶…è¿‡128ä¸ªå­—ç¬¦ ä¸€ä¸ªå¤åˆç´¢å¼•æœ€å¤šå¯ä»¥æœ‰31ä¸ªå­—æ®µ ","permalink":"https://puffinjiang.github.io/posts/tool/indexlimitofmongodb/","summary":"ä½¿ç”¨MongoDBæ—¶ï¼Œç´¢å¼•ç›¸å…³çš„é™åˆ¶å’Œä¼˜åŒ–","title":"Limit Of MongoDB Index"},{"content":"Utoolsæœªå®æ—¶æ›´æ–°ç¯å¢ƒå˜é‡é…ç½®å¯¼è‡´å‘½ä»¤è¡Œå·¥å…·ä½¿ç”¨é”™è¯¯ èƒŒæ™¯ ä»Šå¤©åœ¨ä½¿ç”¨ utoolså·¥å…·æ‰“å¼€ powershell å®‰è£… scoop ï¼Œscoop å®‰è£…æˆåŠŸåï¼Œå¯ä»¥ä½¿ç”¨ scoop ç›¸å…³å‘½ä»¤ï¼Œé‡æ–°æ‰“å¼€ powershell åä½¿ç”¨ scoop å‘½ä»¤æ— æ³•è¯†åˆ«ã€‚\né—®é¢˜å¤ç° æ‰“å¼€utools\nä½¿ç”¨utoolsæ‰“å¼€powershell\nä½¿ç”¨powershellå®‰è£…scoop\nåœ¨powershellä½¿ç”¨scoop helpå‘½ä»¤\nå…³é—­powershellï¼Œä½¿ç”¨utoolsé‡æ–°æ‰“å¼€powershell\nåœ¨powershellä¸­ä½¿ç”¨scoop helpå‘½ä»¤\næ­¤æ—¶å‡ºç°å¦‚ä¸‹çš„é”™è¯¯ä¿¡æ¯ï¼š\n1 2 3 4 5 6 7 D : æ— æ³•å°†â€œDâ€é¡¹è¯†åˆ«ä¸º cmdletã€å‡½æ•°ã€è„šæœ¬æ–‡ä»¶æˆ–å¯è¿è¡Œç¨‹åºçš„åç§°ã€‚è¯·æ£€æŸ¥åç§°çš„æ‹¼å†™ï¼Œå¦‚æœåŒ…æ‹¬è·¯å¾„ï¼Œè¯·ç¡®ä¿è·¯å¾„æ­£ç¡®ï¼Œç„¶å å†è¯•ä¸€æ¬¡ã€‚ æ‰€åœ¨ä½ç½® è¡Œ:1 å­—ç¬¦: 1 + D + ~ + CategoryInfo : ObjectNotFound: (D:String) [], CommandNotFoundException + FullyQualifiedErrorId : CommandNotFoundException è§£å†³æ–¹æ³• é‡æ–°å¯åŠ¨ utools\n","permalink":"https://puffinjiang.github.io/posts/tool/utoolscannotgetnewenvfromsystem/","summary":"utoolsæ— æ³•åŠæ—¶æ›´æ–°æœ€æ–°çš„ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼Œå¯¼è‡´åœ¨ä½¿ç”¨powershellç­‰å‘½ä»¤è¡Œå·¥å…·æ—¶æ— æ³•è¯»å–ç›¸åº”çš„ç¯å¢ƒå˜é‡","title":"Utools Can not Get New Env From System"},{"content":"èƒŒæ™¯ ä»Šå¤©åœ¨æˆ‘æ›´æ–°å®Œè‹¹æœæ¨é€çš„ç³»ç»Ÿæ›´æ–°ä¹‹åï¼Œæ‰“å¼€vscodeæ—¶ï¼Œå¼¹çª—æç¤º Gitæ— æ³•ä½¿ç”¨ ä¹‹ç±»çš„ä¿¡æ¯ã€‚è®©æˆ‘ä»¥ä¸ºæ›´æ–°ä¹‹åGitè¢«åˆ é™¤äº†ï¼Œ äºæ˜¯æˆ‘ä½¿ç”¨ brew upgrade git å‘½ä»¤æƒ³çœ‹ä¸€ä¸‹ä¹‹å‰å®‰è£…è¿‡çš„Gitæ˜¯å¦è¿˜åœ¨\né—®é¢˜ ä½¿ç”¨ brew install git å‘½ä»¤æ—¶ï¼ŒæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š\n1 2 3 4 5 6 7 8 9 10 11 Warning: You are using macOS 13. We do not provide support for this pre-release version. You will encounter build failures with some formulae. Please create pull requests instead of asking for help on Homebrew\u0026#39;s GitHub, Twitter or any other official channels. You are responsible for resolving any issues you experience while you are running this pre-release version. Error: No developer tools installed. Install the Command Line Tools: xcode-select --install è§£å†³æ–¹æ³• è¿è¡Œ xcode-select --install ï¼Œæ­¤å‘½ä»¤ä¼šå®‰è£…ä¼šå¸®åŠ©æˆ‘ä»¬å®‰è£… Command Line Toolsï¼Œå®‰è£…å®Œæˆåå³å¯æ­£å¸¸ä½¿ç”¨ brew å‘½ä»¤äº†ã€‚\n","permalink":"https://puffinjiang.github.io/posts/tool/upgradebrewerrorafterupdatingmacos/","summary":"Git can not used after I updated the MacOS","title":"Upgrade brew error after updating MacOS"},{"content":"Flaskç®€ä»‹ Flaskæ˜¯ä¸€ä¸ªâ€œå¾®â€ python web æ¡†æ¶ï¼Œåªå®ç°äº†æœ€åŸºæœ¬çš„åŠŸèƒ½ï¼Œç®€å•ã€çµæ´»ã€å¯æ‹“å±•æ€§å¼ºã€‚\nç®€å•ï¼šä½¿ç”¨ç®€å•ï¼Œé€šè¿‡ @app.route() è£…é¥°å™¨å³å¯é…ç½®è·¯ç”± çµæ´»ï¼šé…ç½®çµæ´»ï¼Œæ”¯æŒå¤šç§ä¸åŒç±»å‹çš„é…ç½®æ–¹å¼ã€‚å¯è‡ªå®šä¹‰ ä½¿ç”¨dictå¯¹è±¡ ä½¿ç”¨ç¯å¢ƒå˜é‡ app.config.from_envvar() ä½¿ç”¨é…ç½®æ–‡ä»¶ app.config.from_file() åŒ…æ‹¬jsonã€toml å¯æ‹“å±•æ€§å¼ºï¼šå¯è‡ªå®šä¹‰å…¶ä»–éƒ¨åˆ†çš„ç»„ä»¶ï¼Œå¦‚ flask-SQLAlchemyã€flask-session ç­‰ ä¾èµ– flaskä¾èµ–çš„æ ¸å¿ƒç»„ä»¶æœ‰2ä¸ªï¼š werkzeug å’Œ jinjaã€‚ jinja æ˜¯ä¸€ä¸ªæ¨¡ç‰ˆå¼•æ“ï¼Œè´Ÿè´£æ¨¡ç‰ˆçš„æ¸²æŸ“ï¼Œwerkzeug æ˜¯ä¸€ä¸ª WSGI å·¥å…·é›†çš„åº“\nå¯åŠ¨æµç¨‹ åœ¨Flaskçš„å®˜æ–¹æ–‡æ¡£ä¸­ç»™äº†ä¸€ä¸ª \u0026lsquo;Hello World\u0026rsquo; å¯åŠ¨æ¡ˆä¾‹ï¼Œæˆ‘ä»¬æœ¬åœ°å¯åŠ¨ä¸€ä¸‹\n1 2 3 4 5 6 7 8 9 10 from flask import Flask app = Flask(__name__) @app.route(\u0026#34;/\u0026#34;) def hello_world(): return \u0026#34;\u0026lt;p\u0026gt;Hello, World!\u0026lt;/p\u0026gt;\u0026#34; if __name__ == \u0026#39;__main__\u0026#39;: app.run(\u0026#34;127.0.0.1\u0026#34;, 5000) æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ï¼Œå¯åŠ¨çš„æ—¶å€™é¦–å…ˆè°ƒç”¨äº† app.run() æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 class Flask(Scaffold): def run( self, host: t.Optional[str] = None, port: t.Optional[int] = None, debug: t.Optional[bool] = None, load_dotenv: bool = True, **options: t.Any, ) -\u0026gt; None: # Change this into a no-op if the server is invoked from the # command line. Have a look at cli.py for more information. if os.environ.get(\u0026#34;FLASK_RUN_FROM_CLI\u0026#34;) == \u0026#34;true\u0026#34;: from .debughelpers import explain_ignored_app_run explain_ignored_app_run() return if get_load_dotenv(load_dotenv): cli.load_dotenv() # if set, let env vars override previous values if \u0026#34;FLASK_ENV\u0026#34; in os.environ: self.env = get_env() self.debug = get_debug_flag() elif \u0026#34;FLASK_DEBUG\u0026#34; in os.environ: self.debug = get_debug_flag() # debug passed to method overrides all other sources if debug is not None: self.debug = bool(debug) server_name = self.config.get(\u0026#34;SERVER_NAME\u0026#34;) sn_host = sn_port = None if server_name: sn_host, _, sn_port = server_name.partition(\u0026#34;:\u0026#34;) if not host: if sn_host: host = sn_host else: host = \u0026#34;127.0.0.1\u0026#34; if port or port == 0: port = int(port) elif sn_port: port = int(sn_port) else: port = 5000 options.setdefault(\u0026#34;use_reloader\u0026#34;, self.debug) options.setdefault(\u0026#34;use_debugger\u0026#34;, self.debug) options.setdefault(\u0026#34;threaded\u0026#34;, True) cli.show_server_banner(self.env, self.debug, self.name, False) from werkzeug.serving import run_simple try: run_simple(t.cast(str, host), port, self, **options) finally: # reset the first request information if the development server # reset normally. This makes it possible to restart the server # without reloader and that stuff from an interactive shell. self._got_first_request = False æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå‰é¢ä¸€éƒ¨åˆ†ä¸»è¦æ˜¯å¤„ç†ä¸€äº›å¯åŠ¨å‚æ•°ã€‚åœ¨å‚æ•°å¤„ç†å®Œæˆä¹‹åï¼Œè°ƒç”¨äº† werkzeug.serving ä¸­çš„ run_simple å‡½æ•°ï¼Œèƒ½çœ‹åˆ°è¿™ä¸ªå‡½æ•°ä¼ å…¥äº†ä¸€ä¸ª self å‚æ•°ï¼Œå³æˆ‘ä»¬çš„ flask applicationï¼Œæˆ‘ä»¬å†è¿›å…¥è¿™ä¸ª run_simple å½“ä¸­ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 # werkzeugç›¸å…³ä»£ç  def run_simple( hostname: str, port: int, application: \u0026#34;WSGIApplication\u0026#34;, use_reloader: bool = False, use_debugger: bool = False, use_evalex: bool = True, extra_files: t.Optional[t.Iterable[str]] = None, exclude_patterns: t.Optional[t.Iterable[str]] = None, reloader_interval: int = 1, reloader_type: str = \u0026#34;auto\u0026#34;, threaded: bool = False, processes: int = 1, request_handler: t.Optional[t.Type[WSGIRequestHandler]] = None, static_files: t.Optional[t.Dict[str, t.Union[str, t.Tuple[str, str]]]] = None, passthrough_errors: bool = False, ssl_context: t.Optional[_TSSLContextArg] = None, ) -\u0026gt; None: if not isinstance(port, int): raise TypeError(\u0026#34;port must be an integer\u0026#34;) if static_files: from .middleware.shared_data import SharedDataMiddleware # é™æ€æ–‡ä»¶çš„åŠ è½½ application = SharedDataMiddleware(application, static_files) if use_debugger: from .debug import DebuggedApplication # Debugè°ƒè¯• application = DebuggedApplication(application, evalex=use_evalex) if not is_running_from_reloader(): # å¯åŠ¨å‰ socket çš„å‡†å¤‡å’Œæ£€æŸ¥ ï¼Œä½¿ç”¨IPV4è¿˜æ˜¯IPV6ã€ç«¯å£æ˜¯å¦å ç”¨ s = prepare_socket(hostname, port) fd = s.fileno() os.environ[\u0026#34;WERKZEUG_SERVER_FD\u0026#34;] = str(fd) else: fd = int(os.environ[\u0026#34;WERKZEUG_SERVER_FD\u0026#34;]) srv = make_server( hostname, port, application, threaded, processes, request_handler, passthrough_errors, ssl_context, fd=fd, ) if not is_running_from_reloader(): srv.log_startup() if use_reloader: from ._reloader import run_with_reloader run_with_reloader( srv.serve_forever, extra_files=extra_files, exclude_patterns=exclude_patterns, interval=reloader_interval, reloader_type=reloader_type, ) else: srv.serve_forever() ä»ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸¤å¤„å…³é”®çš„å‡½æ•°è°ƒç”¨ï¼Œä¸€å¤„æ˜¯ make_server ï¼Œå¦å¤–ä¸€å¤„æ˜¯ serve_forever ã€‚æˆ‘ä»¬å…ˆçœ‹ make_server åšäº†ä»€ä¹ˆï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 # werkzeugç›¸å…³ä»£ç  def make_server( host: str, port: int, app: \u0026#34;WSGIApplication\u0026#34;, threaded: bool = False, processes: int = 1, request_handler: t.Optional[t.Type[WSGIRequestHandler]] = None, passthrough_errors: bool = False, ssl_context: t.Optional[_TSSLContextArg] = None, fd: t.Optional[int] = None, ) -\u0026gt; BaseWSGIServer: if threaded and processes \u0026gt; 1: raise ValueError(\u0026#34;Cannot have a multi-thread and multi-process server.\u0026#34;) if threaded: # ThreadedWSGIServer ç»§æ‰¿äº† BaseWSGIServer return ThreadedWSGIServer( host, port, app, request_handler, passthrough_errors, ssl_context, fd=fd ) if processes \u0026gt; 1: # ForkingWSGIServer ç»§æ‰¿äº† BaseWSGIServer return ForkingWSGIServer( host, port, app, processes, request_handler, passthrough_errors, ssl_context, fd=fd, ) return BaseWSGIServer( host, port, app, request_handler, passthrough_errors, ssl_context, fd=fd ) èƒ½çœ‹åˆ°è¿™é‡Œæ˜¯è¿”å›äº†ä¸€ä¸ª BaseWSGIServer å®ä¾‹åŒ–å¯¹è±¡ã€‚BaseWSGIServer åœ¨åˆå§‹åŒ–çš„æ—¶å€™ä¸»è¦åšäº† ä¸¤ä»¶äº‹æƒ…ï¼Œä¸€æ˜¯ ç»‘å®šIPå’Œç«¯å£ä»¥åŠç›‘å¬ï¼›äºŒæ˜¯æ·»åŠ  WSGIRequestHandler è¿™ä¸ªè¯·æ±‚å¤„ç†å™¨ã€‚\næˆ‘ä»¬å†æ¥çœ‹çœ‹ serve_forever åšäº†ä»€ä¹ˆï¼š\n1 2 3 4 5 6 7 8 9 10 # werkzeugç›¸å…³ä»£ç  class BaseWSGIServer(HTTPServer): def serve_forever(self, poll_interval: float = 0.5) -\u0026gt; None: try: super().serve_forever(poll_interval=poll_interval) except KeyboardInterrupt: pass finally: self.server_close() å†æ¥è¿›ä¸€æ­¥çœ‹çœ‹çˆ¶ç±»çš„ serve_forever åšäº†ä»€ä¹ˆï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 # werkzeugç›¸å…³ä»£ç  class BaseServer: def serve_forever(self, poll_interval=0.5): \u0026#34;\u0026#34;\u0026#34;Handle one request at a time until shutdown. Polls for shutdown every poll_interval seconds. Ignores self.timeout. If you need to do periodic tasks, do them in another thread. \u0026#34;\u0026#34;\u0026#34; self.__is_shut_down.clear() try: # XXX: Consider using another file descriptor or connecting to the # socket to wake this up instead of polling. Polling reduces our # responsiveness to a shutdown request and wastes cpu at all other # times. # I/Oå¤šè·¯å¤ç”¨é€‰æ‹©å™¨ï¼Œæœ‰pollæ—¶é€‰poll with _ServerSelector() as selector: selector.register(self, selectors.EVENT_READ) while not self.__shutdown_request: # è½®è¯¢ ready = selector.select(poll_interval) # bpo-35017: shutdown() called during select(), exit immediately. if self.__shutdown_request: break if ready: self._handle_request_noblock() self.service_actions() finally: self.__shutdown_request = False self.__is_shut_down.set() æˆ‘ä»¬å¯ä»¥çœ‹åˆ°çš„æ˜¯ç›´æ¥è·³åˆ°äº† BaseServer è¿™ä¸ªç±»ï¼Œè¿™å› ä¸º BaseWSGIServer \u0026ndash;\u0026gt; HTTPServer \u0026ndash;\u0026gt; TCPServer \u0026ndash;\u0026gt; BaseServer ä»–ä»¬ä¹‹é—´æœ‰ç»§æ‰¿å…³ç³»ã€‚æ­¤å¤„é€‰ç”¨äº† PollSelector ä½œä¸º I/Oå¤šè·¯å¤ç”¨é€‰æ‹©å™¨ï¼Œå…³äºI/Oå¤šè·¯å¤ç”¨å°±ä¸è¯¦è¯´äº†ã€‚å½“æœ‰æ´»è·ƒçš„æ–‡ä»¶æè¿°ç¬¦æ—¶ï¼Œæ‰§è¡Œ _handle_request_noblock()æ–¹æ³•ï¼Œåˆ°äº†è¿™é‡Œï¼Œæˆ‘ä»¬çš„åº”ç”¨å¯åŠ¨å¹¶å¼€å§‹ç›‘å¬ç›¸å…³çš„ç«¯å£äº†ã€‚\nè¯·æ±‚å¤„ç†è¿‡ç¨‹ åœ¨ä¸Šé¢æˆ‘ä»¬å·²ç»è¯´åˆ°äº†åº”ç”¨çš„å¯åŠ¨è¿‡ç¨‹ï¼Œæ¥ä¸‹æ¥çœ‹ä¸€çœ‹å½“æ¥æ”¶åˆ°è¯·æ±‚ä¹‹åæ˜¯æ€ä¹ˆå¤„ç†çš„ã€‚ ä¸Šé¢è¯´åˆ°ï¼Œå½“æœ‰æ´»è·ƒçš„æ–‡ä»¶æè¿°ç¬¦ä¼šæ‰§è¡Œ _handle_request_noblock() æ–¹æ³•ï¼Œæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # werkzeugç›¸å…³ä»£ç  class BaseServer: def _handle_request_noblock(self): \u0026#34;\u0026#34;\u0026#34;Handle one request, without blocking. I assume that selector.select() has returned that the socket is readable before this function was called, so there should be no risk of blocking in get_request(). \u0026#34;\u0026#34;\u0026#34; try: request, client_address = self.get_request() except OSError: return if self.verify_request(request, client_address): try: self.process_request(request, client_address) except Exception: self.handle_error(request, client_address) self.shutdown_request(request) except: self.shutdown_request(request) raise else: self.shutdown_request(request) åœ¨è¿™æ®µä»£ç é‡Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™é‡Œæ˜¯è°ƒç”¨äº† process_request æ–¹æ³•å»å¤„ç†æ¥æ”¶åˆ°çš„requestï¼Œè¿™ä¸ªæ—¶å€™å°±åˆ°äº†æˆ‘ä»¬å‰é¢æåˆ°çš„ WSGIRequestHandler è¿™ä¸ªè¯·æ±‚å¤„ç†å™¨äº†ã€‚ WSGIRequestHandler æ˜¯ BaseRequestHandler çš„å­ç±»ï¼Œçœ‹çœ‹åˆå§‹åŒ–ç›¸å…³çš„ä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # werkzeugç›¸å…³ä»£ç  class BaseRequestHandler: def __init__(self, request, client_address, server): self.request = request self.client_address = client_address self.server = server self.setup() try: self.handle() finally: self.finish() def setup(self): pass def handle(self): pass def finish(self): pass ä»ä¸Šé¢çš„ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåˆå§‹åŒ–æ—¶è°ƒç”¨äº† handle æ–¹æ³•ï¼Œåœ¨ handle æ–¹æ³•é‡Œæ˜¯è°ƒç”¨äº† handle_one_request æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 # werkzeugç›¸å…³ä»£ç  class BaseHTTPRequestHandler(socketserver.StreamRequestHandler): def handle_one_request(self): \u0026#34;\u0026#34;\u0026#34;Handle a single HTTP request. You normally don\u0026#39;t need to override this method; see the class __doc__ string for information on how to handle specific HTTP commands such as GET and POST. \u0026#34;\u0026#34;\u0026#34; try: self.raw_requestline = self.rfile.readline(65537) if len(self.raw_requestline) \u0026gt; 65536: self.requestline = \u0026#39;\u0026#39; self.request_version = \u0026#39;\u0026#39; self.command = \u0026#39;\u0026#39; self.send_error(HTTPStatus.REQUEST_URI_TOO_LONG) return if not self.raw_requestline: self.close_connection = True return if not self.parse_request(): # An error code has been sent, just exit return mname = \u0026#39;do_\u0026#39; + self.command if not hasattr(self, mname): self.send_error( HTTPStatus.NOT_IMPLEMENTED, \u0026#34;Unsupported method (%r)\u0026#34; % self.command) return method = getattr(self, mname) method() self.wfile.flush() #actually send the response if not already done. except socket.timeout as e: #a read or a write timed out. Discard this connection self.log_error(\u0026#34;Request timed out: %r\u0026#34;, e) self.close_connection = True return å¯ä»¥çœ‹åˆ°å…³é”®çš„åœ°æ–¹æ˜¯è¿™ä¸ª method æ–¹æ³•çš„è°ƒç”¨ï¼Œè€Œè¿™ä¸ª method å…¶å®å°±æ˜¯ do_GETã€do_POST ç­‰æ–¹æ³•ã€‚é€šè¿‡ debug çœ‹åˆ°ï¼Œè¿™ä¸ªæ–¹æ³•å’Œ WSGIRequestHandler.run_wsgi ç»‘å®šäº†ï¼Œå³è°ƒç”¨äº† WSGIRequestHandler.run_wsgi æ–¹æ³•ï¼Œè¿™æ˜¯å¾ˆå…³é”®çš„ä¸€ä¸ªæ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 # werkzeugç›¸å…³ä»£ç  class WSGIRequestHandler(BaseHTTPRequestHandler): def run_wsgi(self) -\u0026gt; None: if self.headers.get(\u0026#34;Expect\u0026#34;, \u0026#34;\u0026#34;).lower().strip() == \u0026#34;100-continue\u0026#34;: self.wfile.write(b\u0026#34;HTTP/1.1 100 Continue\\r\\n\\r\\n\u0026#34;) self.environ = environ = self.make_environ() status_set: t.Optional[str] = None headers_set: t.Optional[t.List[t.Tuple[str, str]]] = None status_sent: t.Optional[str] = None headers_sent: t.Optional[t.List[t.Tuple[str, str]]] = None chunk_response: bool = False def write(data: bytes) -\u0026gt; None: nonlocal status_sent, headers_sent, chunk_response assert status_set is not None, \u0026#34;write() before start_response\u0026#34; assert headers_set is not None, \u0026#34;write() before start_response\u0026#34; if status_sent is None: status_sent = status_set headers_sent = headers_set try: code_str, msg = status_sent.split(None, 1) except ValueError: code_str, msg = status_sent, \u0026#34;\u0026#34; code = int(code_str) self.send_response(code, msg) header_keys = set() for key, value in headers_sent: self.send_header(key, value) header_keys.add(key.lower()) # Use chunked transfer encoding if there is no content # length. Do not use for 1xx and 204 responses. 304 # responses and HEAD requests are also excluded, which # is the more conservative behavior and matches other # parts of the code. # https://httpwg.org/specs/rfc7230.html#rfc.section.3.3.1 if ( not ( \u0026#34;content-length\u0026#34; in header_keys or environ[\u0026#34;REQUEST_METHOD\u0026#34;] == \u0026#34;HEAD\u0026#34; or (100 \u0026lt;= code \u0026lt; 200) or code in {204, 304} ) and self.protocol_version \u0026gt;= \u0026#34;HTTP/1.1\u0026#34; ): chunk_response = True self.send_header(\u0026#34;Transfer-Encoding\u0026#34;, \u0026#34;chunked\u0026#34;) # Always close the connection. This disables HTTP/1.1 # keep-alive connections. They aren\u0026#39;t handled well by # Python\u0026#39;s http.server because it doesn\u0026#39;t know how to # drain the stream before the next request line. self.send_header(\u0026#34;Connection\u0026#34;, \u0026#34;close\u0026#34;) self.end_headers() assert isinstance(data, bytes), \u0026#34;applications must write bytes\u0026#34; if data: if chunk_response: self.wfile.write(hex(len(data))[2:].encode()) self.wfile.write(b\u0026#34;\\r\\n\u0026#34;) self.wfile.write(data) if chunk_response: self.wfile.write(b\u0026#34;\\r\\n\u0026#34;) self.wfile.flush() def start_response(status, headers, exc_info=None): # type: ignore nonlocal status_set, headers_set if exc_info: try: if headers_sent: raise exc_info[1].with_traceback(exc_info[2]) finally: exc_info = None elif headers_set: raise AssertionError(\u0026#34;Headers already set\u0026#34;) status_set = status headers_set = headers return write def execute(app: \u0026#34;WSGIApplication\u0026#34;) -\u0026gt; None: application_iter = app(environ, start_response) try: for data in application_iter: write(data) if not headers_sent: write(b\u0026#34;\u0026#34;) if chunk_response: self.wfile.write(b\u0026#34;0\\r\\n\\r\\n\u0026#34;) finally: if hasattr(application_iter, \u0026#34;close\u0026#34;): application_iter.close() # type: ignore try: execute(self.server.app) except (ConnectionError, socket.timeout) as e: self.connection_dropped(e, environ) except Exception as e: if self.server.passthrough_errors: raise if status_sent is not None and chunk_response: self.close_connection = True try: # if we haven\u0026#39;t yet sent the headers but they are set # we roll back to be able to set them again. if status_sent is None: status_set = None headers_set = None execute(InternalServerError()) except Exception: pass from .debug.tbtools import DebugTraceback msg = DebugTraceback(e).render_traceback_text() self.server.log(\u0026#34;error\u0026#34;, f\u0026#34;Error on request:\\n{msg}\u0026#34;) è¿™æ®µä»£ç é‡Œæ˜¯ execute(self.server.app) è¿™ä¸€æ®µï¼Œè€Œè¿™ä¸ª server.app å…¶å®å°±æ˜¯æˆ‘ä»¬ä¼ è¿›æ¥çš„ flask applicationäº†ï¼Œé€šè¿‡ application_iter = app(environ, start_response) è¿™ä¸€è¡Œè°ƒç”¨äº† Flask çš„ __call__ æ–¹æ³•ã€‚ä¸Šé¢æ¶‰åŠåˆ°äº†å¾ˆå¤š werkzeug ç›¸å…³çš„ä»£ç ï¼Œç„¶ååœ¨è¿™é‡Œåˆå›åˆ°äº† flaskã€‚ æ¥çœ‹ä¸€çœ‹è¿™ä¸ªæ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 # Flaskç›¸å…³ä»£ç  class Flask(Scaffold): def __call__(self, environ: dict, start_response: t.Callable) -\u0026gt; t.Any: \u0026#34;\u0026#34;\u0026#34;The WSGI server calls the Flask application object as the WSGI application. This calls :meth:`wsgi_app`, which can be wrapped to apply middleware. \u0026#34;\u0026#34;\u0026#34; return self.wsgi_app(environ, start_response) def wsgi_app(self, environ: dict, start_response: t.Callable) -\u0026gt; t.Any: # åˆ›å»ºè¯·æ±‚çš„ä¸Šä¸‹æ–‡ ctx = self.request_context(environ) error: t.Optional[BaseException] = None try: try: ctx.push() response = self.full_dispatch_request() except Exception as e: error = e response = self.handle_exception(e) except: # noqa: B001 error = sys.exc_info()[1] raise return response(environ, start_response) finally: if self.should_ignore_error(error): error = None ctx.auto_pop(error) è¿™æ®µä»£ç é¦–å…ˆæ˜¯åˆ›å»ºè¯·æ±‚çš„ä¸Šä¸‹æ–‡ï¼Œç„¶åé€šè¿‡ self.full_dispatch_request() æ–¹æ³•åˆ†å‘è¯·æ±‚ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹ full_dispatch_request çš„å…·ä½“ä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 class Flask(Scaffold): def full_dispatch_request(self) -\u0026gt; Response: # Run before_first_request functions if this is the thread\u0026#39;s first request. # Inlined to avoid a method call on subsequent requests. # This is deprecated, will be removed in Flask 2.3. if not self._got_first_request: with self._before_request_lock: if not self._got_first_request: for func in self.before_first_request_funcs: self.ensure_sync(func)() self._got_first_request = True try: request_started.send(self) rv = self.preprocess_request() if rv is None: rv = self.dispatch_request() except Exception as e: rv = self.handle_user_exception(e) return self.finalize_request(rv) def dispatch_request(self) -\u0026gt; ft.ResponseReturnValue: req = request_ctx.request if req.routing_exception is not None: self.raise_routing_exception(req) rule: Rule = req.url_rule # type: ignore[assignment] # if we provide automatic options for this URL and the # request came with the OPTIONS method, reply automatically if ( getattr(rule, \u0026#34;provide_automatic_options\u0026#34;, False) and req.method == \u0026#34;OPTIONS\u0026#34; ): return self.make_default_options_response() # otherwise dispatch to the handler for that endpoint view_args: t.Dict[str, t.Any] = req.view_args # type: ignore[assignment] return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args) èƒ½çœ‹çš„åˆ°è¿™é‡Œ dispatch_request åˆ†å‘è¯·æ±‚ï¼Œä½¿ç”¨ handle_user_exception å¤„ç†åˆ†å‘è¿‡ç¨‹ä¸­çš„å¼‚å¸¸å¤„ç†ã€‚åœ¨ dispatch_request å½“ä¸­ï¼Œæ ¹æ®urlè·¯å¾„ï¼Œæ‰¾åˆ°ç›¸åº”çš„æ–¹æ³•ï¼Œå¹¶è°ƒç”¨ï¼Œä»£ç ä¸º self.ensure_sync(self.view_functions[rule.endpoint])(**req.view_args)ã€‚æˆ‘ä»¬å†æ¥çœ‹ä¸€çœ‹ self.finalize_request(rv) åšäº†ä»€ä¹ˆï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # Flaskç›¸å…³ä»£ç  class Flask(Scaffold): def finalize_request( self, rv: t.Union[ResponseReturnValue, HTTPException], from_error_handler: bool = False, ) -\u0026gt; Response: response = self.make_response(rv) try: response = self.process_response(response) request_finished.send(self, response=response) except Exception: if not from_error_handler: raise self.logger.exception( \u0026#34;Request finalizing failed with an error while handling an error\u0026#34; ) return response è¿™é‡Œçš„ finalize_request() å°±æ˜¯æŠŠ view_functions è¿”å›çš„ç»“æœç»„è£…æˆ Response å¹¶è¿”å›ï¼Œåœ¨å…¶ä¸­å¤„ç†äº† statusã€headersã€session ç­‰ï¼Œåˆ°æ­¤æˆ‘ä»¬çš„è¯·æ±‚å¤„ç†å°±ç»“æŸäº†ã€‚\n","permalink":"https://puffinjiang.github.io/posts/tech/flask%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/","summary":"è®°å½•ä¸€ä¸‹é˜…è¯»Flaskæºç çš„è¿‡ç¨‹","title":"Flaskæºç é˜…è¯»"},{"content":"æœ€è¿‘åœ¨ä½¿ç”¨celeryè¿™ä¸ªå¼‚æ­¥æ¡†æ¶ï¼Œåœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°workerè¿è¡Œä¸€æ®µæ—¶é—´åï¼Œå†…å­˜æŒç»­ä¸Šæ¶¨ï¼Œç„¶åå‘Šè­¦ åœ¨ç½‘ä¸ŠæŸ¥è¯¢ä¹‹åå‘ç°äº†Celeryæœ‰å†…å­˜æ³„æ¼çš„é—®é¢˜ï¼ŒrequestsåŒ…ä¹Ÿä¼šæœ‰å†…å­˜æ³„æ¼çš„é—®é¢˜ åœ¨ç½‘ä¸ŠæŸ¥åˆ°çš„è§£å†³æ–¹æ³•æ˜¯\nåœ¨workeræ‰§è¡ŒæŒ‡å®šæ¬¡æ•°ä»»åŠ¡åé‡å»ºæ–°è¿›ç¨‹\n1 2 # æ‰§è¡Œ32æ¬¡åè¢«å¹²æ‰ worker_max_tasks_per_child = 32 åœ¨workerå†…å­˜åˆ°è¾¾æŒ‡å®šé™åˆ¶åé‡å»ºæ–°è¿›ç¨‹\n1 2 # å†…å­˜ä½¿ç”¨é‡è¾¾åˆ° 12m åè¢«å¹²æ‰ worker_max_memory_per_child = 12000 # 12m ","permalink":"https://puffinjiang.github.io/posts/tech/celery%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E8%A7%A3%E5%86%B3/","summary":"è®°ä¸€æ¬¡Celeryå†…å­˜æ³„æ¼çš„é—®é¢˜è§£å†³","title":"Celeryå†…å­˜æ³„æ¼è§£å†³"},{"content":"","permalink":"https://puffinjiang.github.io/links/","summary":"","title":"ğŸ¤å‹é“¾"},{"content":"è¿æ¥ ä½¿ç”¨ psql è¿œç¨‹è¿æ¥ ä½¿ç”¨uriæ–¹å¼ 1 psql postgres://username:password@host:port/dbname ä½¿ç”¨æ™®é€šçš„å‚æ•°æ–¹å¼ 1 psql -U username -h hostname -p port -d dbname æŸ¥è¯¢ åˆ—å‡ºæ‰€æœ‰çš„æ•°æ®åº“å 1 SELECT datname FROM pg_database; æ•°æ®åº“åˆ›å»ºæ“ä½œ åˆ›å»ºç”¨æˆ·åå’Œå¯†ç  1 create user username with encrypted password \u0026#39;password\u0026#39;; åˆ›å»ºæ–°çš„æ•°æ®åº“ 1 create database dbname ; æ•°æ®åº“æˆæƒæ“ä½œ 1 2 -- å°†æ•°æ®åº“ dbname æˆæƒç»™ç”¨æˆ· username grant all privileges on database dbname to username; å¤‡ä»½å’Œæ¢å¤ è¡¨å¤‡ä»½ 1 CREATE TABLE new_table AS SELECT * FROM public.old_table; è¡¨æ•°æ®åˆ é™¤ TRUNCATE å‘½ä»¤ï¼ˆå…¨è¡¨æ•°æ®åˆ é™¤ï¼‰\n1 TRUNCATE TABLE public.new_table; DELETE å‘½ä»¤\n1 DELETE FROM TABLE WHERE id = 1; ","permalink":"https://puffinjiang.github.io/posts/tool/postgresql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/","summary":"è®°å½•ä¸€äº›å¸¸ç”¨çš„PostgreSQLæ•°æ®åº“æ“ä½œå‘½ä»¤","title":"PostgreSQLæ•°æ®åº“å¸¸ç”¨æ“ä½œ"},{"content":"å‰ç½®æ¡ä»¶ windowsç³»ç»Ÿã€githubè®¾ç½®éšç§é‚®ç®±\nä½¿ç”¨Githubç»™çš„é‚®ç®±æ›¿æ¢äº†åŸæœ‰çš„é‚®ç®±ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š\n1 2 git config --global user.name \u0026#34;xxx\u0026#34; git config --global user.email \u0026#34;xxx\u0026#34; ç”¨æ—§çš„é‚®ç®±è¿›è¡Œäº†commit\nè¿‡ç¨‹ åœ¨æ›¿æ¢ä¸ºæ–°çš„é‚®ç®±ä¹‹åä½¿ç”¨ git push å‘½ä»¤æäº¤ä»£ç è¢«æ‹’ç»ï¼Œè¿”å›ä»¥ä¸‹æç¤ºï¼š\n1 2 3 4 Can\u0026#39;t finish GitHub sharing process Successfully created project \u0026#39;xxx\u0026#39; on GitHub, but initial push failed: remote: error: GH007: Your push would publish a private email address. failed to push some refs to \u0026#39;xxx\u0026#39; ä½¿ç”¨ git config --list æŸ¥çœ‹é‚®ç®±æ˜¯å¦æ­£ç¡®\n1 2 user.name=xxx user.email=xxx å‘ç°æ²¡æœ‰é—®é¢˜ï¼Œå’Œä¿®æ”¹åçš„é‚®ç®±ä¸€ç›´\nç»è¿‡å›æº¯ä¹‹åï¼Œå‘ç°åœ¨ä¿®æ”¹é‚®ç®±ä¹‹å‰ï¼Œä½¿ç”¨åŸæ¥çš„é‚®ç®±è¿›è¡Œäº† commitï¼Œä½†æ˜¯æ²¡æœ‰ pushã€‚å› æ­¤commitçš„å†…å®¹ç”¨çš„è¿˜æ˜¯åŸæ¥çš„é‚®ç®±ï¼Œå¯¼è‡´pushæ—¶æŠ¥é”™\nè§£å†³æ–¹æ³• ä½¿ç”¨ git reset å‘½ä»¤å›é€€ç‰ˆæœ¬åˆ° commit ä¹‹å‰ é‡æ–° commit å’Œ pushï¼Œpush æˆåŠŸ ","permalink":"https://puffinjiang.github.io/posts/tool/git%E6%8E%A8%E9%80%81%E4%BB%A3%E7%A0%81%E5%A4%B1%E8%B4%A5/","summary":"åœ¨ä½¿ç”¨ git pushæ—¶æŠ¥ remote: error: GH007: Your push would publish a private email address.","title":"Gitæ¨é€ä»£ç å¤±è´¥"},{"content":"ğŸ‘¨â€ğŸ’» èŒä¸š ç¨‹åºå‘˜\nå¼€å‘è¯­è¨€ Python Java æ•°æ®åº“ Mysql PostgreSQL Redis MongoDB DevOps Jenkins Docker Docker-compose â›¹ å…´è¶£çˆ±å¥½ è¿åŠ¨ï¼šè¶³çƒã€ç¾½æ¯›çƒã€ç¯®çƒç­‰ é˜…è¯»ï¼šæŠ€æœ¯ä¹¦ç±ã€å°è¯´ç­‰ åŠ¨æ¼«ï¼šã€Šå‡¡äººä¿®ä»™ä¼ ã€‹ã€ã€ŠæŸç§‘å­¦çš„è¶…ç”µç£ç‚®ã€‹ç­‰ æ¸¸æˆï¼šCSGO ğŸ“¬ è”ç³»æˆ‘å‘€","permalink":"https://puffinjiang.github.io/about/","summary":"","title":"ğŸ™‹ğŸ»â€â™‚ï¸å…³äºæˆ‘"}]