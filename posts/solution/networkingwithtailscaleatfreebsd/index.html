<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Networking With Tailscale At FreeBSD | Puffin Jiang&#39;s Blog</title>
<meta name="keywords" content="Tailscale, FreeBSD">
<meta name="description" content="Networking With Tailscale At FreeBSD">
<meta name="author" content="
‰ΩúËÄÖÔºöPuffin Jiang">
<link rel="canonical" href="https://puffinjiang.github.io/posts/solution/networkingwithtailscaleatfreebsd/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.34bf4cb683cae568b9d188811604e39e36b24e661d45a315724d1459ee1160b4.css" integrity="sha256-NL9MtoPK5Wi50YiBFgTjnjayTmYdRaMVck0UWe4RYLQ=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://cdn.jsdelivr.net/gh/puffinjiang/oss@main/uPic/1661409751396.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://cdn.jsdelivr.net/gh/puffinjiang/oss@main/uPic/1661409677120.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://cdn.jsdelivr.net/gh/puffinjiang/oss@main/uPic/1661409656713.png">
<link rel="apple-touch-icon" href="https://cdn.jsdelivr.net/gh/puffinjiang/oss@main/uPic/1661409703162.png">
<link rel="mask-icon" href="https://cdn.jsdelivr.net/gh/puffinjiang/oss@main/uPic/1661412250612.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Networking With Tailscale At FreeBSD" />
<meta property="og:description" content="Networking With Tailscale At FreeBSD" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://puffinjiang.github.io/posts/solution/networkingwithtailscaleatfreebsd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-03-28T23:22:16+08:00" />
<meta property="article:modified_time" content="2024-03-28T23:22:16+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Networking With Tailscale At FreeBSD"/>
<meta name="twitter:description" content="Networking With Tailscale At FreeBSD"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "üìöÊñáÁ´†",
      "item": "https://puffinjiang.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "üõ†Ô∏èËß£ÂÜ≥ÊñπÊ°à",
      "item": "https://puffinjiang.github.io/posts/solution/"
    }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "Networking With Tailscale At FreeBSD",
      "item": "https://puffinjiang.github.io/posts/solution/networkingwithtailscaleatfreebsd/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Networking With Tailscale At FreeBSD",
  "name": "Networking With Tailscale At FreeBSD",
  "description": "Networking With Tailscale At FreeBSD",
  "keywords": [
    "Tailscale", "FreeBSD"
  ],
  "articleBody": "Background I have a freebsd laptop at home but it doesn‚Äôt have a public ip so I can‚Äôt access it remotely, I also have a server so I‚Äôm trying to achieve access through tailscale networking.\nInstall Tailscale Here I used pkg to install tailscale\nUpdate pkg 1 pkg update Install Tailscale 1 pkg install tailscale Enable Tailscale ‚ö†Ô∏è It‚Äôs tailscaled not tailscale\n1 sysrc tailscaled_enable=\"YES\" Start Tailscale ‚ö†Ô∏è It‚Äôs tailscaled not tailscale\n1 service tailscaled start Check Tailscale 1 service tailscaled status you should see tailscale is running like this:\n1 tailscaled is running as pid 67663. Connect to server I used headscale as my server, and I tried to connect to it with authkey. For more information on how to install and use headscale, please see the official documentation.\nGenerate authkey We need to generate the authkey on the headscale server first.\n1 headscale --namespace default preauthkeys create --reusable --expiration 24h Then the authkey is like this:\n1 c9bdab8d415f53940f920ee9e729b79ee4e7298cb5acd27d Connect to server 1 tailscale up --login-server=http://:41641 --accept-routes=true --accept-dns=false --authkey=c9bdab8d415f53940f920ee9e729b79ee4e7298cb5acd27d Now you have successfully connected to the server. This exposes only that node to other nodes.\nEnable subnet routes Setting up the configuration file /etc/sysctl.conf\n1 2 echo 'net.ipv4.ip_forward = 1' \u003e\u003e /etc/sysctl.conf echo 'net.ipv6.conf.all.forwarding = 1' \u003e\u003e /etc/sysctl.conf Connect to the server, the subnet range for this node is 192.168.0.1/24.\n1 tailscale up --login-server=http://:41641 --accept-routes=true --accept-dns=false --advertise-routes=192.168.0.1/24 --authkey=c9bdab8d415f53940f920ee9e729b79ee4e7298cb5acd27d Get the node list on the server.\n1 headscale node list --namespace default You can see this node on the server. The id of this node is 3.\nEnable subnet routes in the server.\n1 2 # the id is 3, the subnet range is 192.168.0.1/24 headscale routes enable -i 3 -r \"192.168.0.1/24\" Check if subnet is enabled successfully.\n1 headscale routes list -i 3 we can see that the subnet is enabled like this:\n1 2 Route | Enabled 192.168.0.1/24 | true Viewing nodes on the server 1 headscale node list --namespace default You can see this node on the server.\nUse ping to check connectivity between nodes You can use ping to check connectivity between nodes. My current node‚Äôs ip is 100.64.0.2 and another node‚Äôs ip is 100.64.0.1. So I use ping 100.64.0.1 to check connectivity.\n1 ping 100.64.0.1 You can see that the ping is successful like this:\n1 2 3 PING 100.64.0.1 (100.64.0.1): 56 data bytes 64 bytes from 100.64.0.1: icmp_seq=0 ttl=64 time=965.130 ms 64 bytes from 100.64.0.1: icmp_seq=1 ttl=64 time=12.775 ms You can also use tailscale netcheck to view the report of the connectivity.\n1 tailscale netcheck ",
  "wordCount" : "423",
  "inLanguage": "en",
  "datePublished": "2024-03-28T23:22:16+08:00",
  "dateModified": "2024-03-28T23:22:16+08:00",
  "author":[{
    "@type": "Person",
    "name": "Puffin Jiang"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://puffinjiang.github.io/posts/solution/networkingwithtailscaleatfreebsd/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Puffin Jiang's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://cdn.jsdelivr.net/gh/puffinjiang/oss@main/uPic/1661409751396.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://puffinjiang.github.io" accesskey="h" title="Puffin Jiang&#39;s Blog (Alt + H)">
                <img src="https://cdn.jsdelivr.net/gh/puffinjiang/oss@main/uPic/1661396192756.jpeg" alt="" aria-label="logo"
                    height="35">Puffin Jiang&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://puffinjiang.github.io/search" title="üîçÊêúÁ¥¢ (Alt &#43; /)" accesskey=/>
                    <span>üîçÊêúÁ¥¢</span>
                </a>
            </li>
            <li>
                <a href="https://puffinjiang.github.io/" title="üè†‰∏ªÈ°µ">
                    <span>üè†‰∏ªÈ°µ</span>
                </a>
            </li>
            <li>
                <a href="https://puffinjiang.github.io/posts" title="üìöÊñáÁ´†">
                    <span>üìöÊñáÁ´†</span>
                </a>
            </li>
            <li>
                <a href="https://puffinjiang.github.io/archives" title="‚è±ÂΩíÊ°£">
                    <span>‚è±ÂΩíÊ°£</span>
                </a>
            </li>
            <li>
                <a href="https://puffinjiang.github.io/tags" title="üîñÊ†áÁ≠æ">
                    <span>üîñÊ†áÁ≠æ</span>
                </a>
            </li>
            <li>
                <a href="https://puffinjiang.github.io/about" title="üôãüèª‚Äç‚ôÇÔ∏èÂÖ≥‰∫é">
                    <span>üôãüèª‚Äç‚ôÇÔ∏èÂÖ≥‰∫é</span>
                </a>
            </li>
            <li>
                <a href="https://puffinjiang.github.io/links" title="ü§ùÂèãÈìæ">
                    <span>ü§ùÂèãÈìæ</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://puffinjiang.github.io">Home</a>&nbsp;¬ª&nbsp;<a href="https://puffinjiang.github.io/posts/">üìöÊñáÁ´†</a>&nbsp;¬ª&nbsp;<a href="https://puffinjiang.github.io/posts/solution/">üõ†Ô∏èËß£ÂÜ≥ÊñπÊ°à</a></div>
    <h1 class="post-title">
      Networking With Tailscale At FreeBSD
    </h1>
    <div class="post-description">
      Networking With Tailscale At FreeBSD
    </div>
    <div class="post-meta">










ÂàõÂª∫:&nbsp;<span title='2024-03-28 23:22:16 +0800 +0800'>2024-03-28</span>&nbsp;|&nbsp;Êõ¥Êñ∞:&nbsp;2024-03-28&nbsp;|&nbsp;Â≠óÊï∞:&nbsp;423Â≠ó&nbsp;|&nbsp;Êó∂Èïø: 1ÂàÜÈíü&nbsp;|&nbsp;
‰ΩúËÄÖÔºöPuffin Jiang

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">Table of Contents</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#background" aria-label="Background">Background</a></li>
                    <li>
                        <a href="#install-tailscale" aria-label="Install Tailscale">Install Tailscale</a><ul>
                            
                    <li>
                        <a href="#update-pkg" aria-label="Update pkg">Update pkg</a></li>
                    <li>
                        <a href="#install-tailscale-1" aria-label="Install Tailscale">Install Tailscale</a></li>
                    <li>
                        <a href="#enable-tailscale" aria-label="Enable Tailscale">Enable Tailscale</a></li>
                    <li>
                        <a href="#start-tailscale" aria-label="Start Tailscale">Start Tailscale</a></li>
                    <li>
                        <a href="#check-tailscale" aria-label="Check Tailscale">Check Tailscale</a></li></ul>
                    </li>
                    <li>
                        <a href="#connect-to-server" aria-label="Connect to server">Connect to server</a><ul>
                            
                    <li>
                        <a href="#generate-authkey" aria-label="Generate authkey">Generate authkey</a></li>
                    <li>
                        <a href="#connect-to-server-1" aria-label="Connect to server">Connect to server</a><ul>
                            
                    <li>
                        <a href="#enable-subnet-routes" aria-label="Enable subnet routes">Enable subnet routes</a></li></ul>
                    </li>
                    <li>
                        <a href="#viewing-nodes-on-the-server" aria-label="Viewing nodes on the server">Viewing nodes on the server</a></li>
                    <li>
                        <a href="#use-ping-to-check-connectivity-between-nodes" aria-label="Use ping to check connectivity between nodes">Use ping to check connectivity between nodes</a>
                    </li>
                </ul>
                </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>
  <div class="post-content"><h2 id="background">Background<a hidden class="anchor" aria-hidden="true" href="#background">#</a></h2>
<p>I have a freebsd laptop at home but it doesn&rsquo;t have a public ip so I can&rsquo;t access it remotely, I also have a server so I&rsquo;m trying to achieve access through tailscale networking.</p>
<h2 id="install-tailscale">Install Tailscale<a hidden class="anchor" aria-hidden="true" href="#install-tailscale">#</a></h2>
<p>Here I used pkg to install tailscale</p>
<h3 id="update-pkg">Update pkg<a hidden class="anchor" aria-hidden="true" href="#update-pkg">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>pkg update
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="install-tailscale-1">Install Tailscale<a hidden class="anchor" aria-hidden="true" href="#install-tailscale-1">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>pkg install tailscale
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="enable-tailscale">Enable Tailscale<a hidden class="anchor" aria-hidden="true" href="#enable-tailscale">#</a></h3>
<blockquote>
<p>‚ö†Ô∏è It&rsquo;s tailscaled not tailscale</p>
</blockquote>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sysrc tailscaled_enable=<span style="color:#0ff;font-weight:bold">&#34;YES&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="start-tailscale">Start Tailscale<a hidden class="anchor" aria-hidden="true" href="#start-tailscale">#</a></h3>
<blockquote>
<p>‚ö†Ô∏è It&rsquo;s tailscaled not tailscale</p>
</blockquote>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>service tailscaled start
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="check-tailscale">Check Tailscale<a hidden class="anchor" aria-hidden="true" href="#check-tailscale">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>service tailscaled status
</span></span></code></pre></td></tr></table>
</div>
</div><p>you should see tailscale is running like this:</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>tailscaled is running as pid 67663.
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="connect-to-server">Connect to server<a hidden class="anchor" aria-hidden="true" href="#connect-to-server">#</a></h2>
<p>I used headscale as my server, and I tried to connect to it with authkey. For more information on how to install and use headscale, please see the <a href="https://headscale.net">official documentation</a>.</p>
<h3 id="generate-authkey">Generate authkey<a hidden class="anchor" aria-hidden="true" href="#generate-authkey">#</a></h3>
<p>We need to generate the authkey on the headscale server first.</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>headscale --namespace default preauthkeys create --reusable --expiration 24h
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then the authkey is like this:</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>c9bdab8d415f53940f920ee9e729b79ee4e7298cb5acd27d
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="connect-to-server-1">Connect to server<a hidden class="anchor" aria-hidden="true" href="#connect-to-server-1">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>tailscale up --login-server=http://&lt;your-server-ip&gt;:41641 --accept-routes=<span style="color:#fff;font-weight:bold">true</span> --accept-dns=<span style="color:#fff;font-weight:bold">false</span> --authkey=c9bdab8d415f53940f920ee9e729b79ee4e7298cb5acd27d
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now you have successfully connected to the server. This exposes only that node to other nodes.</p>
<h4 id="enable-subnet-routes">Enable subnet routes<a hidden class="anchor" aria-hidden="true" href="#enable-subnet-routes">#</a></h4>
<ol>
<li>
<p>Setting up the configuration file <code>/etc/sysctl.conf</code></p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>echo &#39;net.ipv4.ip_forward = 1&#39; &gt;&gt; /etc/sysctl.conf
</span></span><span style="display:flex;"><span>echo &#39;net.ipv6.conf.all.forwarding = 1&#39; &gt;&gt; /etc/sysctl.conf
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Connect to the server, the subnet range for this node is <code>192.168.0.1/24</code>.</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>tailscale up --login-server=http://&lt;your-server-ip&gt;:41641 --accept-routes=<span style="color:#fff;font-weight:bold">true</span> --accept-dns=<span style="color:#fff;font-weight:bold">false</span> --advertise-routes=192.168.0.1/24 --authkey=c9bdab8d415f53940f920ee9e729b79ee4e7298cb5acd27d
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Get the node list on the server.</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>headscale node list --namespace default
</span></span></code></pre></td></tr></table>
</div>
</div><p>You can see this node on the server. The id of this node is 3.</p>
</li>
<li>
<p>Enable subnet routes in the server.</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#007f7f"># the id is 3, the subnet range is 192.168.0.1/24</span>
</span></span><span style="display:flex;"><span>headscale routes <span style="color:#fff;font-weight:bold">enable</span> -i <span style="color:#ff0;font-weight:bold">3</span> -r <span style="color:#0ff;font-weight:bold">&#34;192.168.0.1/24&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Check if subnet is enabled successfully.</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>headscale routes list -i <span style="color:#ff0;font-weight:bold">3</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>we can see that the subnet is enabled like this:</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Route            | Enabled
</span></span><span style="display:flex;"><span>192.168.0.1/24   | true
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<h3 id="viewing-nodes-on-the-server">Viewing nodes on the server<a hidden class="anchor" aria-hidden="true" href="#viewing-nodes-on-the-server">#</a></h3>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>headscale node list --namespace default
</span></span></code></pre></td></tr></table>
</div>
</div><p>You can see this node on the server.</p>
<h3 id="use-ping-to-check-connectivity-between-nodes">Use ping to check connectivity between nodes<a hidden class="anchor" aria-hidden="true" href="#use-ping-to-check-connectivity-between-nodes">#</a></h3>
<p>You can use <code>ping</code> to check connectivity between nodes. My current node&rsquo;s ip is <code>100.64.0.2</code> and another node&rsquo;s ip is <code>100.64.0.1</code>. So I use <code>ping 100.64.0.1</code> to check connectivity.</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>ping 100.64.0.1
</span></span></code></pre></td></tr></table>
</div>
</div><p>You can see that the ping is successful like this:</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>PING 100.64.0.1 (100.64.0.1): 56 data bytes
</span></span><span style="display:flex;"><span>64 bytes from 100.64.0.1: icmp_seq=0 ttl=64 time=965.130 ms
</span></span><span style="display:flex;"><span>64 bytes from 100.64.0.1: icmp_seq=1 ttl=64 time=12.775 ms
</span></span></code></pre></td></tr></table>
</div>
</div><p>You can also use <code>tailscale netcheck</code> to view the report of the connectivity.</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>tailscale netcheck
</span></span></code></pre></td></tr></table>
</div>
</div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://puffinjiang.github.io/tags/tailscale/">Tailscale</a></li>
      <li><a href="https://puffinjiang.github.io/tags/freebsd/">FreeBSD</a></li>
    </ul>
<nav class="paginav">
  <a class="next" href="https://puffinjiang.github.io/posts/solution/wgetinstallfailedwithnovalidopenpgponubuntu/">
    <span class="title">Next ¬ª</span>
    <br>
    <span>Wget Install Failed With No Valid Openpgp On Ubuntu</span>
  </a>
</nav>

  </footer><script src="https://utteranc.es/client.js"
    repo="puffinjiang/blog-comment"
    issue-term="pathname"
    label="Comment"
    theme="github-light"
    crossorigin="anonymous"
    async>
</script>
</article>
    </main>
    
<footer class="footer">
    <span>Puffin Jiang</span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
